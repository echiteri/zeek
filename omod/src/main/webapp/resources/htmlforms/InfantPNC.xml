<htmlform formName="Infant - Postnatal Form"
		  formDescription="A visit for an infant for Postnatal Care"
		  formEncounterType="af1f1b24-d2e8-4282-b308-0bf79b365584"
		  formUuid="5022c5d7-ea45-47ce-bd65-1ba1d8ad2467"
		  formVersion="0.9"
		  formAddMetadata="yes"
		  formUILocation="patientDashboard.overallActions"
		  formOrder="15"
		  formIcon="icon-medkit"
		  formShowIf="patient.person.dead==false &amp;&amp; patient.person.age &lt; 2"
		  formDisplayStyle="Standard">
	
	<script type="text/javascript">
		jq(function() {
			<!--/* Show the current location and visit date while hiding the encounter location drop down and date picker for
		encounter date */-->
			jq('#encounterLocation').hide();
			jq('#currentLocation').text(jq('#encounterLocation select option:selected').text());
			jq('#visitDate').text(jq('#encounterDate input:nth-child(1)').val());
		});
	</script>
	
	<h2>
		<label>
            Infant - Postnatal Form
		</label>
	</h2>
	<table id="who-when-where">
		<tbody>
			<tr>
				<td>
					<label>
						Attending Clinican
					</label>
					<encounterProvider default="currentUser" />
				</td>
				<td>
					<label>
						Health Facility
					</label>
					<span id="currentLocation"></span>
					<encounterLocation default="SessionAttribute:emrContext.sessionLocationId"
									   tags="1" /> <!-- Only show Login locations -->
				</td>
				<td>
					<label name="encounterDate">
						Visit Date
					</label>
					<encounterDate default="today" disallowMultipleEncountersOnDate="block" />
				</td>
			</tr>
		</tbody>
	</table>
	<section sectionTag="fieldset" headerTag="legend" headerStyle="title" headerCode="Summary Information">
	<div class="section-container">
		<lookup complexExpression="#foreach ( $relationship in $relationshipList )
										#if( $relationship.relationshipType.aIsToB == 'Parent' )
											  #if( !($relationship.personA.patientId == $patient.patientId ))
												 #if( $relationship.personA.gender == 'F' )
														#set ($mother = $relationship.personA)
												 #end
											  #end
										#end
									#end "/>
		<includeIf velocityTest="$mother">
			<table>
				<tr>
					<th>Mother</th>
					<th>ART Status</th>
					<th>Telephone Number</th>
				</tr>
				<tr>
					<td><lookup expression="mother.personName" /> </td>
					<td> <!-- #Steve: I am not sure if this picks any latest obs or for this client -->
                        <includeIf velocityTest="$fn.latestObs('164860AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA').valueCoded.conceptId == 703
                                || $fn.latestObs('164461AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA').valueCoded.conceptId == 703"> <!-- todo: diplay either of the DNA or Rapid test results -->
                            <!-- Currently displaying only DNA PCR test result -->
                            <lookup	complexExpression="$fn.latestObs('164461AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA').valueCoded.name"/> on <lookup	complexExpression="$fn.latestObs('164461AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA').obsDatetime"/>
                        </includeIf>
                    </td>
					<td><lookup expression="mother.getAttribute('Telephone Number')" /></td>
				</tr>
			</table>
		</includeIf>
		<includeIf velocityTest="!$mother">
			<p>
				<label>Mother</label>
				<relationship type="8d91a210-c2cc-11de-8d13-0010c6dffd0f" whoAmI="B" changeExistingRelationship="true"></relationship>
			</p>
		</includeIf>
	</div>
	</section>
    <includeIf velocityTest="$fn.latestObs('164460AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA').valueCoded.conceptId != 703">
        <!-- don't follow an infant whose confirmatory test is positive -->
        <section sectionTag="fieldset" headerTag="legend" headerStyle="title" headerCode="Exposure and Prophylaxis Information">
            <script>
                jq(function() {

                    <!-- infant tested for HIV -->
                    jq('#infant-hiv-test').click(function(){
                        if (getValue('infant-hiv-test.value') == 1065) {
                            showContainer('#infant-test-type-container');
                            <!-- showContainer('#confirmatory-test-done-container'); -->
                        } else {
                            hideContainer('#infant-test-type-container');
                            <!-- Don't keep the test result container when there is not type of test done-->
                            hideContainer('#dnapcr-test-result-container');
                            hideContainer('#rapid-test-result-container');
                            hideContainer('#confirmatory-test-done-container');
                            hideContainer('#final-test-result-container');
                            hideContainer('#infant-art-number-container');
                            hideContainer('#infant-art-link-container')
                        }
                    });

                    <!-- type of test done -->
                    jq('#infant-test-type').click(function(){
                        if (getValue('infant-test-type.value') == 844) {
                            showContainer('#dnapcr-test-result-container');
                            hideContainer('#rapid-test-result-container');
                        } else if (getValue('infant-test-type.value') == 1042){
                            showContainer('#rapid-test-result-container');
                            hideContainer('#dnapcr-test-result-container');
                        } else {
                            hideContainer('#dnapcr-test-result-container');
                            hideContainer('#rapid-test-result-container');
                        }
                    });
                    <!-- recorded test result for DNA PCR -->
                    jq('#dnapcr-test-result').click(function(){
                            if (getValue('dnapcr-test-result.value') == 703) {
                                showContainer('#confirmatory-test-done-container');
                                <!-- showContainer('#infant-art-number-container'); -->
                                <!-- showContainer('#infant-art-link-container'); -->
                            } else {
                                hideContainer('#confirmatory-test-done-container');
                                <!-- hideContainer('#infant-art-number-container'); -->
                                <!-- hideContainer('#infant-art-link-container'); -->
                            }
                        });
                <!-- recorded test result for Rapid Test -->
                    jq('#rapid-test-result').click(function(){
                            if (getValue('rapid-test-result.value') == 703) {
                                <!--showContainer('#infant-art-number-container');-->
                                <!-- showContainer('#infant-art-link-container'); -->
                                showContainer('#confirmatory-test-done-container'); <!-- A positive RT requires a final confirmatory test done -->
                            } else {
                                hideContainer('#confirmatory-test-done-container');
                                hideContainer('#final-test-result-container'); <!-- don't show the final test result if RT is negative -->
                                <!-- hideContainer('#infant-art-number-container'); -->
                                <!-- hideContainer('#infant-art-link-container'); -->
                            }
                        });
                <!-- confirmatory test done -->
                    jq('#confirmatory-test-done').click(function(){
                        if (getValue('confirmatory-test-done.value') == 1065) {
                            showContainer('#final-test-result-container');
                        } else {
                            hideContainer('#final-test-result-container');
                        }
                    });

                <!-- HIV exposure status -->
                jq('#infant-hiv-exposure-status').click(function(){
                    if (getValue('infant-hiv-exposure-status.value') == 822 || getValue('infant-hiv-exposure-status.value') == 1067) {
                        showContainer('#infant-prophylaxis-status-container');
                        showContainer('#infant-ctx-status-container');
                    } else {
                        hideContainer('#infant-prophylaxis-status-container');
                        hideContainer('#infant-ctx-status-container');
                    }
                });
                <!-- final test result Only link to ART and indicate ART number when final test result returns positive-->
                jq('#final-test-result').click(function(){
                    if (getValue('final-test-result.value') == 703) {
                            showContainer('#infant-art-number-container');
                            showContainer('#infant-art-link-container');
                        } else {
                            hideContainer('#infant-art-number-container');
                            hideContainer('#infant-art-link-container');
                        }
                    });

                });
            </script>
            <div class="section-container">
           <!-- <p class="narrow">
                <label>
                    PTracker Infant Unique Number
                </label> -->
                <!--<patient field="identifier" identifierTypeId="05ee9cf4-7242-4a17-b4d4-00f707265c8a" />-->
                <!-- <input type="text" size="15"/>
            </p> -->
                <!--exclude if: Mother is P (703), KP (1169) and Infant exposed (822) -->
            <excludeIf velocityTest="$fn.latestObs('1396AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA').valueCoded.conceptId == 703 ||
                                    $fn.latestObs('161558AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA').valueCoded.conceptId == 1169 ||
                                    $fn.latestObs('5303AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA').valueCoded.conceptId == 822 ">
                <p>
                    <label>
                        HIV Exposure Status
                    </label>
                    <obs id="infant-hiv-exposure-status" style="radio" conceptId="5303AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptIds="822,1066,1067" answerLabels="Currently Exposed,Currently Unexposed, Unknown" answerSeparator="" />
                </p>
            </excludeIf>

            <p id="infant-prophylaxis-status-container">
                <label>
                    ARV Prophylaxis status
                </label>
                <obs id="infant-prophylaxis-status" style="radio" conceptId="1148AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                     answerConceptIds="1065,1066,160121,1067" answerLabels="Receiving ARV prophylaxis,Never received ARV prophylaxis, Stopped ARV prophylaxis according to guideline, Unknown" answerSeparator=""/>
            </p>
            <p id="infant-prophylaxis-adherence-container" class="hidden">
                <label>ARV Adherence</label>
                <obs style="radio" conceptId="1658AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                     answerConceptIds="159405,159406,159407,1067" answerLabels="Good,Fair,Poor,Unknown" answerSeparator=""/>
            </p>

            <p id="infant-ctx-status-container">
                <label>
                    CTX Prophylaxis status
                </label>
                <obs id="infant-ctx-status" style="radio" conceptId="161652AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                     answerConceptIds="1065,1066,160121,1067" answerLabels="Receiving CTX prophylaxis,Never received CTX prophylaxis, Stopped CTX prophylaxis, Unknown" answerSeparator=""/>
            </p>
            <p id="infant-ctx-adherence-container" class="hidden">
                <label>CTX Adherence</label>
                <obs style="radio" conceptId="162229AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                     answerConceptIds="159405,159406,159407,1067" answerLabels="Good,Fair,Poor,Unknown" answerSeparator=""/>
            </p>

            <p id="infant-hiv-test-container">
                <label>
                    Was this infant tested for HIV during this visit?
                </label>
                <obs id="infant-hiv-test" style="radio" conceptId="161558AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                     answerConceptIds="1065,1066,1067" answerLabels="Tested for HIV during this visit,Not tested for HIV during this visit, Unknown" answerSeparator=""/>
            </p>

            <p id="infant-test-type-container" class="hidden">
                <label>
                    What kind of test was used?
                </label>
                <obs id="infant-test-type" style="radio" conceptId="162087AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptIds="844,1042,1067" answerLabels="DNA PCR, Rapid Test, Unknown" answerSeparator="" />
            </p>
                <p id="dnapcr-test-result-container" class="hidden">
                    <label>
                        What was the DNA PCR test result?
                    </label>
                    <obs id="dnapcr-test-result" style="radio" conceptId="164461AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptIds="664,703,1067"
                         answerLabels="Negative,Positive,Unknown" answerSeparator=""/>
                </p>
                <p id="rapid-test-result-container" class="hidden">
                    <label>
                        What was the Rapid test result?
                    </label>
                    <obs id="rapid-test-result" style="radio" conceptId="164860AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptIds="664,703,1067"
                         answerLabels="Negative,Positive,Unknown" answerSeparator=""/>
                </p>
                <lookup complexExpression="#set ($age = $patient.person.age) "/>
                <!--  <includeIf velocityTest="($age &gt; 1)">TODO: include if the age is more than or equals 18 months -->
                    <p id="confirmatory-test-done-container" class="hidden">
                        <label>
                            Was a confirmatory test performed during this visit?
                        </label> <!-- Child HIV test performed -->
                        <obs id="confirmatory-test-done" style="radio" conceptId="164401AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptIds="1065,1066,1067" answerLabels="Yes, No, Unknown" answerSeparator=""/>
                    </p>
                    <p id="final-test-result-container" class="hidden">
                        <label>
                            What was the final test result for the confirmatory test?
                        </label> <!-- Child HIV antibody test result -->
                        <obs id="final-test-result" style="radio" conceptId="164460AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerSeparator=""/>
                    </p>
                <!-- </includeIf>  -->
            <p id="infant-art-link-container" class="hidden">
                <label>
                    Was this infant linked to ART
                </label>
                <obs id="infant-art-link" style="radio" conceptId="159811AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptIds="1065,1066,1067" answerLabels="Yes, No, Unknown" answerSeparator=""/>
            </p>

            <p id="infant-art-number-container" class="hidden narrow">
                <label>
                    Infant ART Number
                </label>
                <!--<patient field="identifier" identifierTypeId="05ee9cf4-7242-4a17-b4d4-00f707265c8a" />-->
                <input type="text" size="15"/>
            </p>
            </div>
        </section>
        <section sectionTag="fieldset" headerTag="legend" headerStyle="title" headerCode="Infant statuses">
            <div class="section-container radios">
            <p>
                <label>
                    Infant outcome status
                </label>
                <obs id="infant-transfer-status" style="radio" conceptId="160433AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                     answerConceptIds="161636,160563,159492,5240,160432,1067"
                     answerLabels="Still in Care, Transfer In, Transferred Out, Lost to Follow Up, Dead, Unknown" answerSeparator=""/>
            </p>
            <p id="transfer-in-from-container" class="hidden">
                <label>Transferred in from</label>
                <obs conceptId="160535AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" style="location" answerLocationTags="2" />
            </p>
            <p id="transfer-out-to-container" class="hidden">
                <label>Transfered out to</label>
                <obs conceptId="159495AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" style="location" answerLocationTags="2" />
            </p>
            <p id="transfer-in-date-container" class="hidden narrow">
                <label> Transfer in date </label>
                <obs conceptId="160534AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" allowFutureDates="false"/>
            </p>
            <p id="transfer-out-date-container" class="hidden narrow">
                <label> Transfer out date </label>
                <obs conceptId="160649AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" allowFutureDates="false" />
            </p>
            <p id="infant-death-date-container" class="hidden narrow">
                <label>Date of Death</label>
                <obs id="infant-death-date" conceptId="1543AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" allowFutureDates="false"/>
            </p>
            <p id="next-visit-date-container" class="hidden narrow">
                <label>Next visit date </label>
                <obs id="next-visit-date" conceptId="5096AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" allowFutureDates="true"/>
            </p>
        <script>
            jq(function() {
                <!-- show facility transfer from and to and dates for infant transfers -->
                jq('#infant-transfer-status').click(function(){
            <!-- Still in care -->
                    if (getValue('infant-transfer-status.value') == 161636 ||
                        getValue('infant-transfer-status.value') == 160563  ) {
                        showContainer('#next-visit-date-container');
                    } else {
                        hideContainer('#next-visit-date-container');
                    }
            <!-- Transferred in -->
                    if (getValue('infant-transfer-status.value') == 160563) {
                        showContainer('#transfer-in-from-container');
                        showContainer('#transfer-in-date-container');
                    } else {
                        hideContainer('#transfer-in-from-container');
                        hideContainer('#transfer-in-date-container');
                    }
            <!-- Transferred Out -->
                    if (getValue('infant-transfer-status.value') == 159492) {
                        showContainer('#transfer-out-to-container');
                        showContainer('#transfer-out-date-container');
                    } else {
                        hideContainer('#transfer-out-to-container');
                        hideContainer('#transfer-out-date-container');
                    }
            <!-- Dead -->
                    if (getValue('infant-transfer-status.value') == 160432) {
                        showContainer('#infant-death-date-container');
                    } else {
                        hideContainer('#infant-death-date-container');
                    }
                });

            <!-- Show adherence for ARV and CTX if the infant is recieving any -->
                jq('#infant-prophylaxis-status').click(function(){
                    if (getValue('infant-prophylaxis-status.value') == 1065) {
                        showContainer('#infant-prophylaxis-adherence-container');
                    } else {
                        hideContainer('#infant-prophylaxis-adherence-container');
                    }
                });
                jq('#infant-ctx-status').click(function(){
                    if (getValue('infant-ctx-status.value') == 1065) {
                        showContainer('#infant-ctx-adherence-container');
                    } else {
                        hideContainer('#infant-ctx-adherence-container');
                    }
                });
            });
        </script>

            <!--<p>
                <label>
                    Infant mother's status after this visit
                </label>
                <obs style="radio" conceptId="1856AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptIds="161636,159492,1067"
                     answerLabels="Still in Care,Transferred Out, Unknown" answerSeparator=""/>
            </p>-->
           </div>
        </section>
        <submit class="confirm center" />
    </includeIf>
</htmlform>